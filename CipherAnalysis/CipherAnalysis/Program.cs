using System;
using System.Collections.Generic;
using System.Linq;

class Program
{
    static string message = "T cvr zngwqp avcniv wqv Gnkvzavi nuvgxgj nc wqv oxptiztzvgwhngcvivghv xg Rtpqxgjwng, otxsf \r\nhndixvi pvikxhv rtp pvw du avwrvvg wqvAsthl Hqtzavi tgo wqv Pwtwv Ovutiwzvgw. Tg nccxhxts \r\njixggxgjsfivztilvo wqtw Pwtwv'p duuvi vhqvsngp rviv ovsxjqwvo rxwq wqv hifuwtg-tsfpwp' rnil tgo \r\nivto wqv pnsdwxngp vkvif znigxgj rxwq wqvxi nitgjv edxhvtgo hnccvv. Wqv hngcvivghv pndjqw \r\nwn sxzxw wqv wnggtjv nc htuxwts pqxup,tgo tp gvjnwxtwxngp rviv uinhvvoxgj wnrtio xwp hqxvc \r\nivpdsw—wqv Cxkv-Unrvi Wivtwf wqtw thhniovo wnggtjvp xg hviwtxg itwxnp wn wqv \r\nDgxwvoPwtwvp, Aixwtxg, Citghv, Xwtsf, tgo Etutg—Ftiosvf'p wvtz rtp ivtoxgj wqvpvhivw \r\nxgpwidhwxngp nc wqv gvjnwxtwnip. \"Wqv Asthl Hqtzavi, answvo,qxoovg, jdtiovo, pvvp tss, qvtip \r\ntss,\" qv rinwv stwvi, itwqvizvsnoitztwxhtssf. \"Wqndjq wqv asxgop tiv oitrg tgo wqv rxgonrp \r\nqvtkxsfhdiwtxgvo, xwp cti-pvvlxgj vfvp uvgvwitwv wqv pvhivw hngcvivghv hqtzaviptw \r\nRtpqxgjwng, Wnlfn, Sngong, Utixp, Jvgvkt, Inzv. Xwp pvgpxwxkv vtiphtwhq wqv ctxgwvpw \r\nrqxpuvixgjp xg wqv cnivxjg htuxwtsp nc wqv rniso.\"Vthq gtwxng gtwditssf wixvo wn nawtxg wqv \r\nznpw ctknitasv wnggtjv itwxncni xwpvsc; wqv znpw tjjivppxkv xg xwp vccniwp rtp Etutg, rqxhq \r\nvkvg wqvgrtp oivtzxgj vyutgpxngxpw oivtzp xg Tpxt adw cvtivo wn nccvgo wqvDgxwvo Pwtwvp. \r\nTw wqv qvxjqw nc wqv hngcvivghv, rqvg Etutg rtpovztgoxgj t itwxn nc 10 wn 7 rxwq wqv Dgxwvo \r\nPwtwvp tgo Jivtw Aixwtxg,wqv Asthl Hqtzavi ivto rqtw Ftiosvf stwvi htssvo wqv znpw \r\nxzuniwtgwwvsvjitz xw vkvi pnskvo.\"Xw xp gvhvpptif wn tknxo tgf hstpq rxwq Jivtw Aixwtxg tgo \r\nTzvixht,utiwxhdstisf Tzvixht, xg ivjtio wn wqv tiztzvgw sxzxwtwxng bdvpwxng,\" wqvEtutgvpv \r\nCnivxjg Nccxhv htasvo xwp tzatpptoni xg Rtpqxgjwng ngGnkvzavi 28. \"Fnd rxss wn wqv dwznpw \r\nztxgwtxg t zxoosv twwxwdov tgoivondasv fndi vccniwp wn htiif ndw ndi unsxhf. Xg htpv nc \r\nxgvkxwtasvgvhvppxwf fnd rxss rnil wn vpwtasxpq fndi pvhngo uinunpts nc 10 wn 6.5. Xc,xg puxwv \r\nnc fndi dwznpw vccniwp, xw avhnzvp gvhvpptif xg kxvr nc wqvpxwdtwxng tgo xg wqv xgwvivpwp \r\nnc jvgvits unsxhf wn ctss athl ng fndiuinunpts Gn. 3, fnd rxss vgovtkni wn sxzxw wqv unrvi nc \r\nhnghvgwitwxng tgoztgvdkvi nc wqv Uthxcxh af t jdtitgwvv wn ivodhv ni tw svtpw wn ztxgwtxgwqv \r\npwtwdp bdn nc Uthxcxh ovcvgpvp tgo wn ztlv tg tovbdtwv ivpviktwxngrqxhq rxss ztlv hsvti wqtw \r\n[wqxp xp] ndi xgwvgwxng xg tjivvxgj wn t 10 wn 6 itwxn. Gn4 xp wn av tknxovo tp cti tp \r\nunppxasv.\"Vthq 0.5 xg wqv itwxn zvtgw 50,000 wngp nc htuxwts pqxup, ni tandw tatwwsv pqxu tgo \r\nt qtsc. Rxwq wqv xgcniztwxng xg wqxp zvpptjv wvssxgj wqvTzvixhtg gvjnwxtwnip wqtw Etutg \r\nrndso fxvso xc uivppvo, tss wqvf qto wnon rtp uivpp. Wqxp Pvhivwtif nc Pwtwv Hqtisvp Vktgp \r\nQdjqvp oxo, tgo ngOvhvzavi 10 Etutg htuxwdstwvo, xgpwidhwxgj xwp gvjnwxtwni, xg t htasvivto \r\naf wqv Asthl Hqtzavi, wqtw \"wqviv xp gnwqxgj wn on adw thhvuw wqvitwxn uinunpvo af wqv \r\nDgxwvo Pwtwvp.\" Tp pxjgvo, wqv Cxkv-Unrvi Wivtwftssnwwvo htuxwts pqxup wn wqv Dgxwvo \r\nPwtwvp, Jivtw Aixwtxg, Etutg, Citghv,tgo Xwtsf xg wqv itwxn nc 10:10:6:3.3:3.3. Xw rtp \r\nhngpxovitasf svpp wqtgEtutg qto qnuvo cni. Qdjqvp pvgw Ftiosvf t svwwvi nc hnzzvgotwxng.Odixgj \r\nwqv hngcvivghv, wqv Asthl Hqtzavi qto wdigvo ndw zniv wqtg5,000 pnsdwxngp tgo witgpstwxngp. \r\nFtiosvf gvtisf pdccvivo t gvikndpaivtlonrg, tgo xg Cvaidtif rvgw wn Tixmngt cni cndi zngwqp wn \r\nivhnkviqxp qvtswq. Pvkvits nc qxp tppxpwtgwp qto tsivtof qto windasv xg wqxpivjtio. Ngv ataasvo \r\nxghnqvivgwsf; t jxis oivtzvo nc hqtpxgj tindgo wqvavoinnz t adssonj wqtw, rqvg htdjqw, qto \"hnov\" \r\nrixwwvg ng xwp pxov;tgnwqvi hndso sxjqwvg wqv vgnizndp pthl nc uvaasvp wqtw pqv htiixvo xg \r\ntivhdiixgj gxjqwztiv ngsf af cxgoxgj t pwngv tsngj t sngvsf avthq wqtwvythwsf ztwhqvo ngv nc qvi \r\nuvaasvp, rqxhq pqv hndso wqvg htpw xgwn wqvpvt. Tss wqivv ivpxjgvo.";
    static List<string> lowercasedLetters = new List<string>(); // Track letters made lowercase
    static List<string> replacedLetters = new List<string>();   // Track replaced letters
    static string decryptedMessage;

    // Function to count letter frequencies
    static Dictionary<char, int> LetterFrequencyAnalysis(string text)
    {
        var frequency = new Dictionary<char, int>();
        string alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

        foreach (char letter in alphabet)
            frequency[letter] = 0;

        text = new string(text.Where(char.IsLetter).ToArray()).ToUpper();

        foreach (char letter in text)
            frequency[letter]++;

        return frequency.OrderByDescending(f => f.Value).ToDictionary(f => f.Key, f => f.Value);
    }

    static string englishLetterFrequency = "ETAOINSHRDLCUMWFGYPBVKJXQZ";

    // Function to build dynamic frequency mappings for letters
    static Dictionary<char, char> BuildFrequencyMapping(Dictionary<char, int> sortedMessageFreq)
    {
        var mapping = new Dictionary<char, char>();
        int i = 0;

        foreach (var pair in sortedMessageFreq)
        {
            if (i < englishLetterFrequency.Length)
                mapping[pair.Key] = englishLetterFrequency[i];
            i++;
        }

        return mapping;
    }

    // Function to decrypt message based on letter frequency mappings
    static string Decryption(string message, Dictionary<char, char> letterMapping)
    {
        string decryptedText = "";

        for (int i = 0; i < message.Length; i++)
        {
            char letter = char.ToUpper(message[i]);
            decryptedText += letterMapping.ContainsKey(letter) ? letterMapping[letter] : letter;
        }

        return decryptedText;
    }

    static void ShowFrequency(Dictionary<char, int> frequency)
    {
        Console.WriteLine("\nLetter Frequencies:");
        foreach (var kvp in frequency)
        {
            Console.WriteLine($"{kvp.Key}: {kvp.Value}");
        }
    }

    static void ShowMenu()
    {
        Console.WriteLine("\nChoose an action:");
        Console.WriteLine("1. Change letters to lowercase");
        Console.WriteLine("2. Replace letter");
        Console.WriteLine("3. Change letters to uppercase");
        Console.WriteLine("4. Exit");

        string choice = Console.ReadLine();

        switch (choice)
        {
            case "1":
                ChangeToLowerCase();
                break;
            case "2":
                ReplaceLetter();
                break;
            case "3":
                ChangeToUpperCase();
                break;
            case "4":
                return;
            default:
                Console.WriteLine("Invalid choice. Please try again.");
                ShowMenu();
                break;
        }
    }

    static void ReplaceLetter()
    {
        Console.WriteLine("Enter the letter to replace (format: A->B):");
        string input = Console.ReadLine().ToUpper();
        var parts = input.Split("->");

        if (parts.Length == 2)
        {
            string oldLetter = parts[0];
            string newLetter = parts[1];

            if (lowercasedLetters.Contains(oldLetter) || lowercasedLetters.Contains(newLetter))
            {
                Console.WriteLine($"One of the letters ('{oldLetter}' or '{newLetter}') has been made lowercase and cannot be replaced.");
            }
            else
            {
                string placeholder = "©"; // Placeholder character

                // Replace oldLetter with placeholder
                decryptedMessage = decryptedMessage.Replace(oldLetter, placeholder);

                // Replace newLetter with oldLetter
                decryptedMessage = decryptedMessage.Replace(newLetter, oldLetter);

                // Replace placeholder with newLetter
                decryptedMessage = decryptedMessage.Replace(placeholder, newLetter);

                Console.WriteLine("Modified message:");
                Console.WriteLine(decryptedMessage);
            }
        }
        else
        {
            Console.WriteLine("Invalid input format.");
        }

        ShowMenu();
    }

    static void ChangeToLowerCase()
    {
        Console.WriteLine("Enter the letters you want to make lowercase (separate with spaces):");
        string letters = Console.ReadLine().ToUpper();
        var lettersArray = letters.Split(' ');

        foreach (var letter in lettersArray)
        {
            decryptedMessage = decryptedMessage.Replace(letter, letter.ToLower());
            lowercasedLetters.Add(letter);
        }

        Console.WriteLine("Modified message:");
        Console.WriteLine(decryptedMessage);
        ShowMenu();
    }

    static void ChangeToUpperCase()
    {
        Console.WriteLine("Enter the letters you want to make uppercase (separate with spaces):");
        string letters = Console.ReadLine().ToLower();
        var lettersArray = letters.Split(' ');

        foreach (var letter in lettersArray)
        {
            decryptedMessage = decryptedMessage.Replace(letter.ToLower(), letter.ToUpper());
            lowercasedLetters.Remove(letter.ToUpper());
        }

        Console.WriteLine("Modified message:");
        Console.WriteLine(decryptedMessage);
        ShowMenu();
    }

    static void Main(string[] args)
    {
        var letterFrequencies = LetterFrequencyAnalysis(message);
        ShowFrequency(letterFrequencies); // Show frequencies before decryption

        var dynamicLetterMapping = BuildFrequencyMapping(letterFrequencies);

        decryptedMessage = Decryption(message, dynamicLetterMapping);

        Console.WriteLine("\nDecrypted message:");
        Console.WriteLine(decryptedMessage);

        ShowMenu();
    }
}
